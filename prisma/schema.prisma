generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Order {
  id              String      @id @default(uuid())
  orderId         String      @unique // Stripe payment intent ID or custom order ID
  paymentIntentId String?     // Stripe payment intent ID
  
  // Customer Information
  customerEmail   String
  customerFirstName String
  customerLastName  String
  customerPhone    String?
  
  // Shipping Address
  shippingAddress  String
  shippingCity     String
  shippingState    String
  shippingZipCode  String
  shippingCountry  String      @default("US")
  
  // Order Details
  items            Json        // Array of order items (products with quantity, price, etc.)
  subtotal         Float
  shippingCost     Float       @default(10.0)
  total            Float
  
  // Order Status
  orderStatus      OrderStatus @default(ORDERED)
  statusUpdatedAt  DateTime?
  
  // Metadata
  isTestMode       Boolean     @default(false)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  
  @@index([orderId])
  @@index([customerEmail])
  @@index([orderStatus])
  @@index([createdAt])
  @@index([isTestMode])
}

model Product {
  id          Int      @id @default(autoincrement())
  category    String
  name        String
  price       String   // Formatted price string like "$185"
  priceValue  Float    // Numeric price value for calculations
  description String   @default("")
  
  // Supabase Storage Image Fields
  // image: Primary image path in Supabase Storage bucket (e.g., "products/1/main.jpg")
  //       Can be a single path, comma-separated paths, or folder path ending with "/"
  image       String   @default("") // Path to image in Supabase Storage bucket
  
  // images: JSON array of image paths for multiple images
  //         Format: ["products/1/main.jpg", "products/1/detail-1.jpg", ...]
  //         If null, falls back to parsing the 'image' field
  images      Json?    // Array of image paths in Supabase Storage bucket
  
  // imageBucket: Name of the Supabase Storage bucket (defaults to env var if not specified)
  imageBucket    String? // Optional: Override default bucket name for this product
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([category])
  @@index([name])
}

enum OrderStatus {
  ORDERED
  COURIERED
  DELIVERED
}

model AdminUser {
  id            String   @id @default(uuid())
  email         String   @unique
  passwordHash  String   // bcrypt hashed password
  name          String?
  isActive      Boolean  @default(true)
  lastLoginAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([email])
}
